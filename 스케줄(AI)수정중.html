<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 ë·°í‹° PM ë¡œë“œë§µ (Ultimate Edition)</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- React Beautiful DnD -->
    <script src="https://unpkg.com/react-beautiful-dnd@13.1.1/dist/react-beautiful-dnd.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        body { font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; background-color: #f8fafc; color: #334155; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .fade-in { animation: fadeIn 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Markdown Styles */
        .prose h3 { font-size: 1.1em; font-weight: 800; margin-top: 1.2em; margin-bottom: 0.6em; color: #0f172a; display: flex; align-items: center; gap: 6px; }
        .prose ul { list-style-type: none; padding-left: 0; margin-bottom: 1em; }
        .prose li { position: relative; padding-left: 1.2em; margin-bottom: 0.4em; line-height: 1.6; }
        .prose li::before { content: "â€¢"; position: absolute; left: 0; color: #cbd5e1; font-weight: bold; }
        .prose strong { color: #0f172a; font-weight: 700; background: #f1f5f9; padding: 0 4px; border-radius: 4px; }
        
        /* Urgent Pulse & Ticker */
        .urgent-card { border: 1.5px solid #fca5a5 !important; background-color: #fff1f2 !important; }
        .mask-image-linear { mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent); }
        
        /* Dashboard Charts */
        .progress-bar { transition: width 1s ease-in-out; }

        /* Calendar Specific */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); }
        
        /* Select Styling */
        .custom-select {
            font-family: 'Pretendard', sans-serif;
            background-color: transparent; border: none; outline: none; cursor: pointer; appearance: none;
            padding-right: 1.2em;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2364748b' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right center; background-repeat: no-repeat; background-size: 1.2em 1.2em;
        }
        
        .settings-btn { position: relative; z-index: 9999; pointer-events: auto; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        const { DragDropContext, Droppable, Draggable } = window.ReactBeautifulDnd;

        // --- Constants ---
        const BRANDS = {
            KIDSTEN: { name: 'í‚¤ì¦ˆí…', color: 'border-yellow-400', bg: 'bg-yellow-50', dot: 'bg-yellow-500', bar: 'bg-yellow-400', text: 'text-yellow-900', identity: 'ì–´ë¦°ì´ìš© ì•ˆì „ í™”ì¥í’ˆ, ì—„ë§ˆì˜ ë§ˆìŒ' },
            ATOCURE: { name: 'ì•„í† íì–´', color: 'border-blue-400', bg: 'bg-blue-50', dot: 'bg-blue-500', bar: 'bg-blue-500', text: 'text-blue-900', identity: 'ë”ë§ˆì½”ìŠ¤ë©”í‹±, ê³ ê¸°ëŠ¥ì„±, ì„ìƒê¸°ë°˜, ë¯¼ê°ì„±/ì—¬ë“œë¦„' },
            SELEVA: { name: 'ì…€ë ˆë°”', color: 'border-purple-400', bg: 'bg-purple-50', dot: 'bg-purple-500', bar: 'bg-purple-500', text: 'text-purple-900', identity: '3050 ìŠ¤ë§ˆíŠ¸ ì—ì´ì§•, ì•ˆí‹°ì—ì´ì§•, í”„ë¦¬ë¯¸ì—„' },
            "BOMBI.U": { name: 'ë´„ë¹„ìœ ', color: 'border-green-400', bg: 'bg-green-50', dot: 'bg-green-500', bar: 'bg-green-500', text: 'text-green-900', identity: 'íƒˆëª¨ ì „ë¬¸ í—¤ì–´ì¼€ì–´, ìì—°ìœ ë˜' },
        };
        const BRAND_MAPPING = { 'KIDS10': 'KIDSTEN', 'CELEVA': 'SELEVA', 'BOMBIYU': 'BOMBI.U' };
        
        const HOLIDAYS_DB = {
            2025: { '01-01': 'ì‹ ì •', '01-28': 'ì„¤ë‚  ì—°íœ´', '01-29': 'ì„¤ë‚ ', '01-30': 'ì„¤ë‚  ì—°íœ´', '03-01': 'ì‚¼ì¼ì ˆ', '03-03': 'ëŒ€ì²´ê³µíœ´ì¼', '05-05': 'ì–´ë¦°ì´ë‚ ', '05-06': 'ëŒ€ì²´ê³µíœ´ì¼', '06-06': 'í˜„ì¶©ì¼', '08-15': 'ê´‘ë³µì ˆ', '10-03': 'ê°œì²œì ˆ', '10-05': 'ì¶”ì„ ì—°íœ´', '10-06': 'ì¶”ì„', '10-07': 'ì¶”ì„ ì—°íœ´', '10-08': 'ëŒ€ì²´ê³µíœ´ì¼', '10-09': 'í•œê¸€ë‚ ', '12-25': 'ì„±íƒ„ì ˆ' },
            2026: { '01-01': 'ì‹ ì •', '02-16': 'ì„¤ë‚  ì—°íœ´', '02-17': 'ì„¤ë‚ ', '02-18': 'ì„¤ë‚  ì—°íœ´', '03-01': 'ì‚¼ì¼ì ˆ', '03-02': 'ëŒ€ì²´ê³µíœ´ì¼', '05-05': 'ì–´ë¦°ì´ë‚ ', '05-24': 'ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ', '05-25': 'ëŒ€ì²´ê³µíœ´ì¼', '06-06': 'í˜„ì¶©ì¼', '08-15': 'ê´‘ë³µì ˆ', '09-24': 'ì¶”ì„ ì—°íœ´', '09-25': 'ì¶”ì„', '09-26': 'ì¶”ì„ ì—°íœ´', '10-03': 'ê°œì²œì ˆ', '10-09': 'í•œê¸€ë‚ ', '12-25': 'ì„±íƒ„ì ˆ' },
            2027: { '01-01': 'ì‹ ì •', '02-06': 'ì„¤ë‚  ì—°íœ´', '02-07': 'ì„¤ë‚ ', '02-08': 'ì„¤ë‚  ì—°íœ´', '02-09': 'ëŒ€ì²´ê³µíœ´ì¼', '03-01': 'ì‚¼ì¼ì ˆ', '05-05': 'ì–´ë¦°ì´ë‚ ', '05-13': 'ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ', '06-06': 'í˜„ì¶©ì¼', '06-07': 'ëŒ€ì²´ê³µíœ´ì¼', '08-15': 'ê´‘ë³µì ˆ', '08-16': 'ëŒ€ì²´ê³µíœ´ì¼', '09-14': 'ì¶”ì„ ì—°íœ´', '09-15': 'ì¶”ì„', '09-16': 'ì¶”ì„ ì—°íœ´', '10-03': 'ê°œì²œì ˆ', '10-04': 'ëŒ€ì²´ê³µíœ´ì¼', '10-09': 'í•œê¸€ë‚ ', '10-11': 'ëŒ€ì²´ê³µíœ´ì¼', '12-25': 'ì„±íƒ„ì ˆ' }
        };

        const STAGES = [
            { id: 'planning', label: '1.ê¸°íš', progress: 20, color: 'bg-slate-100 text-slate-600', icon: 'Clipboard' },
            { id: 'sampling', label: '2.ìƒ˜í”Œ', progress: 40, color: 'bg-indigo-50 text-indigo-600', icon: 'Beaker' },
            { id: 'design', label: '3.ë””ìì¸', progress: 60, color: 'bg-pink-50 text-pink-600', icon: 'Palette' },
            { id: 'production', label: '4.ìƒì‚°', progress: 80, color: 'bg-orange-50 text-orange-600', icon: 'Factory' },
            { id: 'launch', label: '5.ëŸ°ì¹­', progress: 100, color: 'bg-emerald-50 text-emerald-600', icon: 'Rocket' }
        ];

        const STATUS_OPTIONS = {
            functional: [{ value: 'none', label: 'ë¯¸ë³´ê³ ', color: 'bg-gray-200 text-gray-700' }, { value: 'pending', label: 'ì§„í–‰ì¤‘', color: 'bg-orange-200 text-orange-800' }, { value: 'done', label: 'ì™„ë£Œ', color: 'bg-green-200 text-green-800' }],
            clinical: [{ value: 'none', label: 'ë¯¸ì§„í–‰', color: 'bg-gray-200 text-gray-700' }, { value: 'pending', label: 'ì§„í–‰ì¤‘', color: 'bg-orange-200 text-orange-800' }, { value: 'done', label: 'ì™„ë£Œ', color: 'bg-green-200 text-green-800' }],
            vegan: [{ value: 'none', label: 'í•´ë‹¹ì—†ìŒ', color: 'bg-gray-200 text-gray-500' }, { value: 'pending', label: 'ì‹¬ì‚¬ì¤‘', color: 'bg-orange-200 text-orange-800' }, { value: 'done', label: 'ì™„ë£Œ', color: 'bg-green-200 text-green-800' }]
        };

        const INITIAL_DATA = [
            { id: '1', brand: 'KIDSTEN', name: 'ë¬´ê¸°ìì°¨ ì„ ì¿ ì…˜', targetYear: 2026, targetMonth: 3, targetDay: 15, isUrgent: true, stage: 'design', category: 'Sun Care', vendor: 'ì½”ìŠ¤ë§¥ìŠ¤', packaging: 'ì—°ìš°', targetPrice: '28000', targetCost: '5000', memo: 'ìš©ê¸° ê¸ˆí˜• ìˆ˜ì •ìœ¼ë¡œ 1ì£¼ ì§€ì—° ê°€ëŠ¥ì„± ìˆìŒ. ì—…ì²´ í™•ì¸ í•„ìš”.', functional: 'done', clinical: 'pending', vegan: 'none', assignee: 'ê¹€PM', specTarget: 'ì–´ë¦°ì´', specConcept: 'ì•ˆì‹¬ì„±ë¶„', specVolume: '15g', specIngredients: 'ì§•í¬ì˜¥ì‚¬ì´ë“œ' },
            { id: '2', brand: 'ATOCURE', name: 'ì‹œì¹´ ì•°í”Œ í† ë„ˆ', targetYear: 2026, targetMonth: 9, targetDay: 10, isUrgent: false, stage: 'sampling', category: 'Skincare', vendor: 'í•œêµ­ì½œë§ˆ', packaging: 'ë¯¼ì§„', targetPrice: '32000', targetCost: '4800', memo: '', functional: 'none', clinical: 'none', vegan: 'pending', sampleRound: '2ì°¨', isSampleConfirmed: false, assignee: 'ì´ëŒ€ë¦¬', specTarget: 'ë¯¼ê°ì„±', specConcept: 'ì§„ì •', specVolume: '200ml', specIngredients: 'ì‹œì¹´' },
            { id: '3', brand: 'SELEVA', name: 'ë ˆí‹°ë†€ ì•„ì´í¬ë¦¼', targetYear: 2026, targetMonth: 10, targetDay: 1, isUrgent: false, stage: 'planning', category: 'Anti-aging', vendor: 'ì½”ìŠ¤ë©”ì¹´', packaging: 'ë¯¸ì •', targetPrice: '58000', targetCost: '11000', memo: 'ì„ìƒ ë¹„ìš© ê²¬ì  ë¹„êµ ì¤‘', functional: 'pending', clinical: 'pending', vegan: 'none', assignee: 'ê¹€PM', specTarget: '3040', specConcept: 'ì£¼ë¦„ê°œì„ ', specVolume: '30ml', specIngredients: 'ë ˆí‹°ë†€' },
        ];

        // --- Helper Functions ---
        const getBrand = (key) => BRANDS[key] || { name: 'Unknown', color: 'border-gray-200', bg: 'bg-gray-50', dot: 'bg-gray-400', bar: 'bg-gray-400', text: 'text-gray-500' };
        
        // Data Migration - Ensure all fields exist
        const migrateData = (data) => {
            if (!Array.isArray(data)) return [];
            return data.map(p => ({
                ...p,
                brand: BRAND_MAPPING[p.brand] || p.brand,
                targetYear: p.targetYear || 2026,
                functional: p.functional || 'none',
                clinical: p.clinical || 'none',
                vegan: p.vegan || 'none',
                sampleRound: p.sampleRound || '1ì°¨',
                isSampleConfirmed: p.isSampleConfirmed || false,
                assignee: p.assignee || 'ë¯¸ì§€ì •',
                specTarget: p.specTarget || '',
                specConcept: p.specConcept || '',
                specVolume: p.specVolume || '',
                specIngredients: p.specIngredients || '',
                targetPrice: p.targetPrice || '',
                targetCost: p.targetCost || '',
                vendor: p.vendor || '',
                packaging: p.packaging || '',
                image: p.image || ''
            }));
        };

        const getDotColor = (val) => val === 'done' ? 'bg-green-500' : (val === 'pending' ? 'bg-orange-500' : 'bg-gray-300');
        
        const calculateMargin = (price, cost) => {
            if (!price || !cost) return 0;
            const p = parseFloat(String(price).replace(/,/g, ''));
            const c = parseFloat(String(cost).replace(/,/g, ''));
            if (p === 0 || isNaN(p) || isNaN(c)) return 0;
            return Math.round(((p - c) / p) * 100);
        };
        
        const formatDateShort = (isoString) => {
            if (!isoString) return '';
            const date = new Date(isoString);
            return `${date.getMonth() + 1}.${date.getDate()} ${String(date.getHours()).padStart(2,'0')}:${String(date.getMinutes()).padStart(2, '0')}`;
        };

        // --- Icons ---
        const Icons = {
            Plus: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
            X: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>,
            Settings: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>,
            Calendar: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>,
            Layout: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>,
            ShieldAlert: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>,
            ListCheck: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M11 12H3"/><path d="M16 6H3"/><path d="M16 18H3"/><path d="M21 12h-6"/><path d="M21 6h-6"/><path d="M21 18h-6"/><path d="m9 6 2 2 4-4"/></svg>,
            Bot: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>,
            Key: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M2 18v3c0 .6.4 1 1 1h4v-3h3v-3h2l1.4-1.4a6.5 6.5 0 1 0-4-4Z"/><circle cx="16.5" cy="7.5" r=".5"/></svg>,
            Siren: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M12 2a3 3 0 0 0-3 3v7c0 1.1.9 2 2 2h2a2 2 0 0 0 2-2V5a3 3 0 0 0-3-3Z"/><path d="m19 13-1.4-1.4"/><path d="M5 13 6.4 11.6"/><path d="M19.7 17a2.2 2.2 0 0 1-2.7 2.7l-10-10a2.2 2.2 0 0 1 2.7-2.7Z"/></svg>,
            Bell: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>,
            CheckCircle: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
            PieChart: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>,
            Activity: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>,
            FileText: ({width=16, height=16, ...props}) => <svg xmlns="http://www.w3.org/2000/svg" width={width} height={height} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>,
            ChevronLeft: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m15 18-6-6 6-6"/></svg>,
            ChevronRight: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m9 18 6-6-6-6"/></svg>,
            Factory: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/><path d="M17 18h1"/><path d="M12 18h1"/><path d="M7 18h1"/></svg>,
            Package: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>,
            ClipboardCheck: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="m9 14 2 2 4-4"/></svg>,
            DollarSign: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
            Beaker: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M4.5 3h15"/><path d="M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3"/><path d="M6 14h12"/></svg>,
            Tag: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"/><path d="M7 7h.01"/></svg>,
            Palette: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="13.5" cy="6.5" r=".5"/><circle cx="17.5" cy="10.5" r=".5"/><circle cx="8.5" cy="7.5" r=".5"/><circle cx="6.5" cy="12.5" r=".5"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"/></svg>,
            Rocket: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"/><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/></svg>,
            Image: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>,
            History: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M3 3v5h5"/><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"/><path d="M12 7v5l4 2"/></svg>,
            User: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
            MessageSquare: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>,
            Send: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>,
            Trash2: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>,
            Reply: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polyline points="9 17 4 12 9 7"></polyline><path d="M20 18v-2a4 4 0 0 0-4-4H4"></path></svg>,
            Calculator: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="16" y1="14" x2="16" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>,
            Target: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
            Tool: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
        };

        const STAGE_ICONS = { 'planning': Icons.ClipboardCheck, 'sampling': Icons.Beaker, 'design': Icons.Palette, 'production': Icons.Factory, 'launch': Icons.Rocket };

        // --- Widgets ---
        const ClockWidget = () => {
            const [time, setTime] = useState(new Date());
            useEffect(() => { const t = setInterval(() => setTime(new Date()), 1000); return () => clearInterval(t); }, []);
            const formatDate = (date) => `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')} (${['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][date.getDay()]})`;
            return (
                <div className="px-6 py-4 bg-slate-50 border-t border-slate-100 shrink-0">
                    <div className="text-[11px] font-bold text-slate-400 mb-1">{formatDate(time)}</div>
                    <div className="text-xl font-black text-slate-700 tracking-wider font-mono">{time.toLocaleTimeString('ko-KR', { hour12: false })}</div>
                </div>
            );
        };

        // --- New Utility Components ---
        const BeautyTools = () => {
            const [unitType, setUnitType] = useState('weight'); // 'weight' (g->oz) or 'volume' (ml->fl oz)
            const [metricValue, setMetricValue] = useState('');
            
            const convertedResult = useMemo(() => {
                if(!metricValue) return 0;
                const val = parseFloat(metricValue);
                if(isNaN(val)) return 0;
                
                // 1 g = 0.035274 oz
                // 1 ml = 0.033814 fl oz
                if(unitType === 'weight') return (val * 0.035274).toFixed(3);
                else return (val * 0.033814).toFixed(3);
            }, [metricValue, unitType]);

            const [cost, setCost] = useState('');
            const [price, setPrice] = useState('');
            const marginCalc = useMemo(() => {
                if(!cost || !price) return { margin: 0, rate: 0 };
                const c = parseFloat(cost);
                const p = parseFloat(price);
                if(p === 0) return { margin: 0, rate: 0 };
                return { margin: p - c, rate: ((p - c) / p * 100).toFixed(1) };
            }, [cost, price]);

            return (
                <div className="max-w-4xl mx-auto space-y-6 fade-in">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {/* Export Unit Converter */}
                        <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                            <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2"><Icons.Beaker className="text-blue-500"/> ìˆ˜ì¶œìš© ë‹¨ìœ„ ë³€í™˜ê¸° (Export Unit)</h3>
                            <div className="flex bg-slate-100 p-1 rounded-lg mb-4">
                                <button onClick={() => { setUnitType('weight'); setMetricValue(''); }} className={`flex-1 py-1.5 text-xs font-bold rounded-md transition ${unitType === 'weight' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>ì¤‘ëŸ‰ (g â” oz)</button>
                                <button onClick={() => { setUnitType('volume'); setMetricValue(''); }} className={`flex-1 py-1.5 text-xs font-bold rounded-md transition ${unitType === 'volume' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>ë¶€í”¼ (ml â” fl. oz)</button>
                            </div>
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-xs font-bold text-slate-400 mb-1">{unitType === 'weight' ? 'ë‚´ìš©ë¬¼ ë¬´ê²Œ (g)' : 'ë‚´ìš©ë¬¼ ìš©ëŸ‰ (ml)'}</label>
                                    <input type="number" value={metricValue} onChange={(e) => setMetricValue(e.target.value)} className="w-full border border-slate-200 rounded-lg px-3 py-2 text-lg font-bold text-slate-700" placeholder="0" />
                                    {/* Quick Buttons */}
                                    <div className="flex gap-2 mt-2">
                                        {(unitType === 'weight' ? [30, 50, 100] : [30, 50, 100, 150]).map(val => (
                                            <button key={val} onClick={() => setMetricValue(val)} className="px-2 py-1 bg-slate-50 border border-slate-200 rounded text-xs text-slate-500 hover:bg-slate-100 hover:text-blue-600 transition">{val}{unitType === 'weight' ? 'g' : 'ml'}</button>
                                        ))}
                                    </div>
                                </div>
                                <div className="pt-4 border-t border-slate-100">
                                    <div className="text-xs text-slate-400 mb-1">ë³€í™˜ ê²°ê³¼ ({unitType === 'weight' ? 'Net Wt.' : 'Net Vol.'})</div>
                                    <div className="text-3xl font-black text-blue-600 tracking-tight">{convertedResult} <span className="text-base text-slate-500 font-bold">{unitType === 'weight' ? 'oz.' : 'fl. oz.'}</span></div>
                                </div>
                            </div>
                        </div>

                        {/* Quick Margin Calculator */}
                        <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                            <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2"><Icons.PieChart className="text-emerald-500"/> í€µ ë§ˆì§„ ê³„ì‚°ê¸°</h3>
                            <div className="space-y-4">
                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-xs font-bold text-slate-400 mb-1">ì›ê°€ (Total Cost)</label>
                                        <input type="number" value={cost} onChange={(e) => setCost(e.target.value)} className="w-full border border-slate-200 rounded-lg px-3 py-2" placeholder="5000" />
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-slate-400 mb-1">íŒë§¤ê°€ (Price)</label>
                                        <input type="number" value={price} onChange={(e) => setPrice(e.target.value)} className="w-full border border-slate-200 rounded-lg px-3 py-2" placeholder="25000" />
                                    </div>
                                </div>
                                <div className="pt-4 border-t border-slate-100 flex justify-between items-center">
                                    <div>
                                        <div className="text-xs text-slate-400 mb-1">ì´ìµê¸ˆ</div>
                                        <div className="text-lg font-bold text-slate-700">{marginCalc.margin.toLocaleString()}ì›</div>
                                    </div>
                                    <div className="text-right">
                                        <div className="text-xs text-slate-400 mb-1">ë§ˆì§„ìœ¨</div>
                                        <div className={`text-2xl font-black ${parseFloat(marginCalc.rate) >= 70 ? 'text-emerald-500' : (parseFloat(marginCalc.rate) >= 50 ? 'text-blue-500' : 'text-red-500')}`}>{marginCalc.rate}%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Quick Links */}
                    <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                        <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2"><Icons.ListCheck className="text-purple-500"/> í•„ìˆ˜ ì‚¬ì´íŠ¸ ë°”ë¡œê°€ê¸°</h3>
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <a href="https://www.hwahae.co.kr/" target="_blank" className="flex items-center gap-2 p-3 border border-slate-100 rounded-lg hover:bg-slate-50 transition text-sm font-bold text-slate-600">ğŸŒ¿ í™”í•´ (ì„±ë¶„ë¶„ì„)</a>
                            <a href="https://www.ewg.org/skindeep/" target="_blank" className="flex items-center gap-2 p-3 border border-slate-100 rounded-lg hover:bg-slate-50 transition text-sm font-bold text-slate-600">ğŸ’§ EWG SkinDeep</a>
                            <a href="https://nedrug.mfds.go.kr/index" target="_blank" className="flex items-center gap-2 p-3 border border-slate-100 rounded-lg hover:bg-slate-50 transition text-sm font-bold text-slate-600">ğŸ¥ ì˜ì•½í’ˆì•ˆì „ë‚˜ë¼</a>
                            <a href="https://kcia.or.kr/" target="_blank" className="flex items-center gap-2 p-3 border border-slate-100 rounded-lg hover:bg-slate-50 transition text-sm font-bold text-slate-600">ğŸ‡°ğŸ‡· ëŒ€í•œí™”ì¥í’ˆí˜‘íšŒ</a>
                        </div>
                    </div>
                </div>
            );
        };

        const MarketingDDay = () => {
            const [launchDate, setLaunchDate] = useState('');
            const schedule = useMemo(() => {
                if(!launchDate) return [];
                const d = new Date(launchDate);
                const addDays = (date, days) => {
                    const result = new Date(date);
                    result.setDate(result.getDate() + days);
                    return result;
                };
                
                return [
                    { label: 'ì œí’ˆ ê¸°íš í™•ì • (BM)', days: -120, type: 'planning' },
                    { label: 'ë¶€ìì¬ ë°œì£¼ (CT)', days: -60, type: 'production' },
                    { label: 'ìƒì„¸í˜ì´ì§€ ê¸°íš', days: -45, type: 'design' },
                    { label: 'ì œí’ˆ ì´¬ì˜ (ìŠ¤íŠœë””ì˜¤)', days: -30, type: 'design' },
                    { label: 'ì²´í—˜ë‹¨ ëª¨ì§‘ ì‹œì‘', days: -21, type: 'marketing' },
                    { label: 'ìì‚¬ëª°/ì˜¤í”ˆë§ˆì¼“ ë”œ ì„¸íŒ…', days: -14, type: 'marketing' },
                    { label: 'ì™€ë””ì¦ˆ/í¬ë¼ìš°ë“œ í€ë”© ì˜¤í”ˆ', days: -10, type: 'marketing' },
                    { label: 'ê³µì‹ ëŸ°ì¹­ (Launch Day)', days: 0, type: 'launch' },
                    { label: '1ì°¨ ë¦¬ë·° ì·¨í•© ë° ë°”ì´ëŸ´', days: 14, type: 'marketing' }
                ].map(item => {
                    const date = addDays(d, item.days);
                    const today = new Date();
                    const diff = Math.ceil((date - today) / (1000 * 60 * 60 * 24));
                    return { ...item, date: date.toISOString().split('T')[0], dday: diff };
                });
            }, [launchDate]);

            return (
                <div className="max-w-3xl mx-auto bg-white rounded-xl border border-slate-200 shadow-sm p-8 fade-in h-full">
                    <div className="text-center mb-8">
                        <h2 className="text-2xl font-black text-slate-800 mb-2">ğŸš€ ë§ˆì¼€íŒ… ëŸ°ì¹­ ì—­ì‚° ìŠ¤ì¼€ì¤„ëŸ¬</h2>
                        <p className="text-slate-500 text-sm">ëŸ°ì¹­ ëª©í‘œì¼ë§Œ ì…ë ¥í•˜ë©´ ë§ˆì¼€íŒ… í•„ìˆ˜ D-Dayë¥¼ ìë™ìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤.</p>
                    </div>
                    
                    <div className="flex justify-center mb-10">
                        <div className="relative">
                            <input type="date" value={launchDate} onChange={(e) => setLaunchDate(e.target.value)} className="text-xl font-bold border-2 border-blue-500 rounded-xl px-6 py-3 shadow-lg outline-none text-slate-800" />
                            <div className="absolute -top-3 left-4 bg-white px-1 text-xs font-bold text-blue-600">ëŸ°ì¹­ ëª©í‘œì¼</div>
                        </div>
                    </div>

                    <div className="space-y-4">
                        {schedule.length === 0 ? (
                            <div className="text-center py-10 text-slate-300 border-2 border-dashed border-slate-100 rounded-xl">
                                ğŸ“… ë‚ ì§œë¥¼ ì„ íƒí•˜ë©´ ìŠ¤ì¼€ì¤„ì´ ìƒì„±ë©ë‹ˆë‹¤.
                            </div>
                        ) : (
                            schedule.map((item, idx) => (
                                <div key={idx} className={`flex items-center p-4 rounded-lg border ${item.days === 0 ? 'bg-blue-50 border-blue-200 ring-1 ring-blue-300' : 'bg-white border-slate-100 hover:border-slate-300 transition'}`}>
                                    <div className={`w-12 h-12 rounded-full flex items-center justify-center font-bold text-white mr-4 shrink-0 ${item.days === 0 ? 'bg-blue-600' : (item.dday < 0 ? 'bg-slate-300' : (item.dday <= 7 ? 'bg-red-500 animate-pulse' : 'bg-slate-800'))}`}>
                                        {item.days === 0 ? 'D-Day' : `D${item.days}`}
                                    </div>
                                    <div className="flex-1">
                                        <div className={`font-bold text-base ${item.days === 0 ? 'text-blue-700' : 'text-slate-700'}`}>{item.label}</div>
                                        <div className="text-xs text-slate-400">{item.date}</div>
                                    </div>
                                    <div className={`px-3 py-1 rounded-full text-xs font-bold ${item.dday < 0 ? 'bg-slate-100 text-slate-400' : (item.dday === 0 ? 'bg-blue-100 text-blue-700' : 'bg-orange-100 text-orange-700')}`}>
                                        {item.dday < 0 ? 'ì™„ë£Œë¨' : (item.dday === 0 ? 'ì˜¤ëŠ˜' : `${item.dday}ì¼ ë‚¨ìŒ`)}
                                    </div>
                                </div>
                            ))
                        )}
                    </div>
                </div>
            );
        };


        const Dashboard = ({ projects }) => {
            const stats = useMemo(() => {
                const total = projects.length;
                const completed = projects.filter(p => p.stage === 'launch').length;
                const inProgress = total - completed;
                const completionRate = total === 0 ? 0 : Math.round((completed / total) * 100);
                const brandCounts = projects.reduce((acc, p) => { if (BRANDS[p.brand]) acc[p.brand] = (acc[p.brand] || 0) + 1; return acc; }, {});
                return { total, completed, inProgress, completionRate, brandCounts };
            }, [projects]);

            const sortedProjects = useMemo(() => {
                return [...projects].sort((a, b) => {
                    const getProgress = (stageId) => STAGES.find(s => s.id === stageId)?.progress || 0;
                    const aDone = a.stage === 'launch';
                    const bDone = b.stage === 'launch';
                    if (aDone && !bDone) return 1;
                    if (!aDone && bDone) return -1;
                    if (!aDone && !bDone) {
                        if (a.isUrgent && !b.isUrgent) return -1;
                        if (!a.isUrgent && b.isUrgent) return 1;
                        return getProgress(b.stage) - getProgress(a.stage);
                    }
                    return 0;
                });
            }, [projects]);

            return (
                <div className="mb-8 fade-in">
                    <h2 className="text-lg font-extrabold text-slate-800 mb-4 flex items-center gap-2"><Icons.PieChart /> í”„ë¡œì íŠ¸ í˜„í™© ëŒ€ì‹œë³´ë“œ</h2>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                            <div className="text-slate-400 text-xs font-bold uppercase mb-1">ì „ì²´ í”„ë¡œì íŠ¸</div>
                            <div className="text-2xl font-black text-slate-800">{stats.total}<span className="text-sm font-medium text-slate-400 ml-1">ê±´</span></div>
                        </div>
                        <div className="bg-white p-4 rounded-xl border border-blue-100 shadow-sm">
                            <div className="text-blue-500 text-xs font-bold uppercase mb-1">ì§„í–‰ ì¤‘ (Working)</div>
                            <div className="text-2xl font-black text-blue-600">{stats.inProgress}<span className="text-sm font-medium text-blue-400 ml-1">ê±´</span></div>
                        </div>
                        <div className="bg-white p-4 rounded-xl border border-emerald-100 shadow-sm">
                            <div className="text-emerald-500 text-xs font-bold uppercase mb-1">ëŸ°ì¹­ ì™„ë£Œ (Done)</div>
                            <div className="text-2xl font-black text-emerald-600">{stats.completed}<span className="text-sm font-medium text-emerald-400 ml-1">ê±´</span></div>
                        </div>
                        <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm relative overflow-hidden">
                            <div className="text-slate-400 text-xs font-bold uppercase mb-1">ì „ì²´ ë‹¬ì„±ë¥ </div>
                            <div className="text-2xl font-black text-slate-800">{stats.completionRate}%</div>
                             <div className="absolute bottom-0 left-0 h-1 bg-slate-100 w-full"><div className="h-full bg-emerald-500 transition-all duration-1000" style={{ width: `${stats.completionRate}%` }}></div></div>
                        </div>
                    </div>
                    {/* Brand Share & Project Progress */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div className="bg-white p-5 rounded-xl border border-slate-200 shadow-sm md:col-span-1">
                            <h3 className="text-sm font-bold text-slate-700 mb-4 flex items-center gap-2"><Icons.Activity /> ë¸Œëœë“œë³„ ì ìœ ìœ¨</h3>
                            <div className="space-y-3">
                                {Object.entries(BRANDS).map(([key, b]) => {
                                    const count = stats.brandCounts[key] || 0;
                                    const percent = stats.total === 0 ? 0 : Math.round((count / stats.total) * 100);
                                    if (count === 0) return null;
                                    return (
                                        <div key={key}>
                                            <div className="flex justify-between text-xs mb-1 font-bold">
                                                <span className="text-slate-600">{b.name}</span>
                                                <span className="text-slate-400">{count}ê±´ ({percent}%)</span>
                                            </div>
                                            <div className="w-full bg-slate-100 rounded-full h-2 overflow-hidden">
                                                <div className={`h-full rounded-full ${b.bar} progress-bar`} style={{ width: `${percent}%` }}></div>
                                            </div>
                                        </div>
                                    )
                                })}
                            </div>
                        </div>
                        <div className="bg-white p-5 rounded-xl border border-slate-200 shadow-sm md:col-span-2 overflow-hidden">
                            <h3 className="text-sm font-bold text-slate-700 mb-4 flex items-center gap-2"><Icons.ListCheck /> ì£¼ìš” í”„ë¡œì íŠ¸ ì§„í–‰ë¥ </h3>
                            <div className="space-y-3 max-h-[160px] overflow-y-auto custom-scrollbar pr-2">
                                {sortedProjects.map(p => {
                                    const stageInfo = STAGES.find(s => s.id === p.stage);
                                    const brandInfo = getBrand(p.brand);
                                    const isDone = p.stage === 'launch';
                                    
                                    return (
                                        <div key={p.id} className={`group ${isDone ? 'opacity-60 grayscale' : ''}`}>
                                            <div className="flex justify-between items-center text-xs mb-1.5">
                                                <div className="flex items-center gap-2">
                                                    {p.isUrgent && !isDone && <span className="text-[9px] bg-red-100 text-red-600 px-1 rounded font-bold animate-pulse">ê¸´ê¸‰</span>}
                                                    <span className={`font-bold text-slate-700 ${isDone ? 'line-through decoration-slate-400' : ''}`}>{p.name}</span>
                                                    {p.assignee && <span className="text-[9px] bg-slate-100 text-slate-500 px-1 rounded">{p.assignee}</span>}
                                                    <span className="text-slate-400 text-[10px]">{p.targetMonth}ì›” ëŸ°ì¹­</span>
                                                </div>
                                                <span className={`font-bold ${stageInfo?.color?.split(' ')[1]}`}>{stageInfo?.label} ({stageInfo?.progress}%)</span>
                                            </div>
                                            <div className="w-full bg-slate-50 rounded-full h-2.5 overflow-hidden border border-slate-100">
                                                <div className={`h-full rounded-full ${brandInfo.bar} progress-bar group-hover:opacity-80 transition`} style={{ width: `${stageInfo?.progress}%` }}></div>
                                            </div>
                                        </div>
                                    );
                                })}
                                {sortedProjects.length === 0 && (
                                    <div className="text-center text-slate-400 text-xs py-10">ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const CalendarView = ({ projects, onEdit, onDragEnd }) => {
            const [currentDate, setCurrentDate] = useState(new Date(2026, 0, 1));
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const firstDay = new Date(year, month, 1).getDay();
            
            const handleDragEnd = (result) => {
                if (!result.destination) return;
                const newDay = parseInt(result.destination.droppableId.replace('day-', ''));
                if (newDay) onDragEnd(result.draggableId, newDay, month + 1, year);
            };
            const monthlyProjects = projects.filter(p => p.targetMonth === month + 1 && p.targetYear === year);

            return (
                <DragDropContext onDragEnd={handleDragEnd}>
                <div className="fade-in pb-10">
                    <div className="flex justify-between items-center mb-6">
                        <div className="flex items-center gap-2">
                            <Icons.Calendar className="text-slate-800" />
                            <div className="flex items-center gap-1">
                                <select value={year} onChange={(e) => setCurrentDate(new Date(parseInt(e.target.value), month, 1))} className="custom-select text-xl font-bold text-slate-800 px-2 py-1 rounded transition-all hover:bg-slate-100">{Object.keys(HOLIDAYS_DB).map(y => <option key={y} value={y}>{y}ë…„</option>)}</select>
                                <select value={month} onChange={(e) => setCurrentDate(new Date(year, parseInt(e.target.value), 1))} className="custom-select text-xl font-bold text-slate-800 px-2 py-1 rounded transition-all hover:bg-slate-100">{Array.from({length: 12}, (_, i) => i).map(m => <option key={m} value={m}>{m + 1}ì›”</option>)}</select>
                            </div>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={() => setCurrentDate(new Date(year, month - 1, 1))} className="p-2 bg-white border rounded-lg hover:bg-slate-50"><Icons.ChevronLeft /></button>
                            <button onClick={() => setCurrentDate(new Date(year, month + 1, 1))} className="p-2 bg-white border rounded-lg hover:bg-slate-50"><Icons.ChevronRight /></button>
                        </div>
                    </div>
                    <div className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                        <div className="calendar-grid border-b border-slate-200 bg-slate-50">{['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'].map((d, i) => <div key={d} className={`text-center py-3 text-xs font-bold ${i === 0 ? 'text-red-500' : 'text-slate-500'}`}>{d}</div>)}</div>
                        <div className="calendar-grid bg-slate-100 gap-[1px]">
                            {Array.from({ length: firstDay }).map((_, i) => <div key={`empty-${i}`} className="bg-white min-h-[120px] p-2"></div>)}
                            {Array.from({ length: daysInMonth }).map((_, i) => {
                                const day = i + 1;
                                const dateKey = `${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                                const isHoliday = !!(HOLIDAYS_DB[year] || {})[dateKey];
                                const isSunday = new Date(year, month, day).getDay() === 0;

                                return (
                                    <Droppable key={day} droppableId={`day-${day}`}>
                                        {(provided, snapshot) => (
                                            <div ref={provided.innerRef} {...provided.droppableProps} className={`bg-white min-h-[120px] p-2 transition ${snapshot.isDraggingOver ? 'bg-blue-50' : 'hover:bg-slate-50'}`}>
                                                <div className="flex justify-between items-start mb-1">
                                                    <div className={`text-xs font-bold ${isSunday || isHoliday ? 'text-red-500' : 'text-slate-700'}`}>{day}</div>
                                                    {isHoliday && <div className="text-[10px] text-red-500 font-medium truncate max-w-[60px] text-right">{(HOLIDAYS_DB[year] || {})[dateKey]}</div>}
                                                </div>
                                                <div className="space-y-1">
                                                    {monthlyProjects.filter(p => p.targetDay === day).map((p, index) => (
                                                        <Draggable key={p.id} draggableId={p.id} index={index}>
                                                            {(provided) => (
                                                                <div ref={provided.innerRef} {...provided.draggableProps} {...provided.dragHandleProps} onClick={() => onEdit(p)} className={`text-[10px] p-1.5 rounded cursor-pointer border hover:shadow-sm leading-tight ${p.isUrgent ? 'bg-red-50 border-red-100 text-red-700 font-bold' : 'bg-slate-50 border-slate-100 text-slate-600'}`} style={{ ...provided.draggableProps.style }}>
                                                                    {p.image && <div className="mb-1 w-full h-8 bg-cover bg-center rounded-sm" style={{backgroundImage: `url(${p.image})`}}></div>}
                                                                    <div className="flex items-center gap-1 mb-0.5"><span className={`w-1.5 h-1.5 rounded-full ${getBrand(p.brand).dot}`}></span><span className="truncate font-bold">{p.brand}</span></div>
                                                                    <div className="truncate mb-1">{p.name}</div>
                                                                    {p.stage === 'sampling' && <div className={`text-[8px] px-1 py-0.5 rounded text-center ${p.isSampleConfirmed ? 'bg-green-100 text-green-700' : 'bg-purple-100 text-purple-700'}`}>{p.isSampleConfirmed ? 'âœ…í™•ì •' : p.sampleRound}</div>}
                                                                </div>
                                                            )}
                                                        </Draggable>
                                                    ))}
                                                    {provided.placeholder}
                                                </div>
                                            </div>
                                        )}
                                    </Droppable>
                                );
                            })}
                        </div>
                    </div>
                </div>
                </DragDropContext>
            );
        };

        // --- Data Logic ---
        const initLocal = (setMode, setProjects, setTeamMembers) => {
            setMode('local');
            const savedData = localStorage.getItem('beauty_roadmap_data');
            const savedTeam = localStorage.getItem('beauty_roadmap_team');
            if (savedTeam) { try { setTeamMembers(JSON.parse(savedTeam)); } catch(e) {} }
            if (savedData) { try { setProjects(migrateData(JSON.parse(savedData))); } catch(e) { setProjects(INITIAL_DATA); } }
            else { setProjects(INITIAL_DATA); localStorage.setItem('beauty_roadmap_data', JSON.stringify(INITIAL_DATA)); }
        };

        const initFirebase = (config, setDb, setMode, setProjects, setTeamMembers) => {
            try {
                if (!firebase.apps.length) firebase.initializeApp(config);
                const auth = firebase.auth();
                auth.signInAnonymously().catch(e => console.error(e));
                const firestore = firebase.firestore();
                setDb(firestore);
                setMode('firebase');
                firestore.collection('projects').onSnapshot((snapshot) => setProjects(migrateData(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })))), () => setMode('local'));
                firestore.collection('team_members').onSnapshot((snapshot) => {
                    const members = snapshot.docs.map(doc => doc.id);
                    if(members.length > 0) setTeamMembers(['ë¯¸ì§€ì •', ...new Set(members)].sort());
                });
            } catch (e) { initLocal(setMode, setProjects, setTeamMembers); }
        };

        // --- Restored Chat & History Logic ---
        const fetchComments = (projectId, mode, db, setComments) => {
             if (mode === 'firebase' && db) {
                 return db.collection('comments').where('projectId', '==', String(projectId)).onSnapshot(snapshot => {
                        const newComments = snapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
                        newComments.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                        setComments(newComments);
                    });
             } else {
                 const allComments = JSON.parse(localStorage.getItem('beauty_roadmap_comments') || '[]');
                 setComments(allComments.filter(c => String(c.projectId) === String(projectId)).sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp)));
                 return () => {}; 
             }
        };

        const addComment = async (e, commentInput, editingProject, userName, replyingTo, mode, db, setComments, setCommentInput, setReplyingTo) => {
            e.preventDefault();
            if (!commentInput.trim() || !editingProject) return;
            const commentData = { projectId: String(editingProject.id), text: commentInput, author: userName || 'Unknown', timestamp: new Date().toISOString(), replyTo: replyingTo ? { author: replyingTo.author, text: replyingTo.text } : null };
            if (mode === 'firebase' && db) await db.collection('comments').add(commentData);
            else {
                const newComment = { ...commentData, id: `loc_${Date.now()}` };
                const allComments = JSON.parse(localStorage.getItem('beauty_roadmap_comments') || '[]');
                const updatedComments = [...allComments, newComment];
                localStorage.setItem('beauty_roadmap_comments', JSON.stringify(updatedComments));
                setComments(prev => [...prev, newComment].sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp)));
            }
            setCommentInput('');
            setReplyingTo(null);
        };

        const deleteComment = async (commentId, mode, db, setComments) => {
            if(!confirm('ë©”ì‹œì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            if (mode === 'firebase' && db) await db.collection('comments').doc(commentId).delete();
            else {
                const allComments = JSON.parse(localStorage.getItem('beauty_roadmap_comments') || '[]');
                const updated = allComments.filter(c => c.id !== commentId);
                localStorage.setItem('beauty_roadmap_comments', JSON.stringify(updated));
                setComments(prev => prev.filter(c => c.id !== commentId));
            }
        };

        const addHistoryLog = async (projectId, projectName, action, detail, userName, mode, db, setHistoryLogs) => {
            const logData = { projectId: String(projectId), projectName, action, detail, author: userName || 'Unknown', timestamp: new Date().toISOString() };
            if (mode === 'firebase' && db) await db.collection('logs').add({ ...logData, serverTime: firebase.firestore.FieldValue.serverTimestamp() });
            else {
                const existingLogs = JSON.parse(localStorage.getItem('beauty_roadmap_logs') || '[]');
                localStorage.setItem('beauty_roadmap_logs', JSON.stringify([logData, ...existingLogs]));
            }
            // Update local state if viewing this project
            setHistoryLogs(prev => [logData, ...prev]);
        };

        const fetchHistoryLogs = async (projectId, mode, db, setHistoryLogs) => {
            if (mode === 'firebase' && db) {
                try {
                    const snap = await db.collection('logs').where('projectId', '==', String(projectId)).limit(50).get();
                    const logs = snap.docs.map(doc => ({ ...doc.data(), timestamp: doc.data().timestamp || new Date().toISOString() }));
                    logs.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    setHistoryLogs(logs);
                } catch (e) { setHistoryLogs([]); }
            } else {
                const allLogs = JSON.parse(localStorage.getItem('beauty_roadmap_logs') || '[]');
                setHistoryLogs(allLogs.filter(l => String(l.projectId) === String(projectId)).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)));
            }
        };

        function App() {
            const [view, setView] = useState('gantt'); 
            const [mode, setMode] = useState('local'); 
            const [projects, setProjects] = useState([]);
            const [selectedBrand, setSelectedBrand] = useState('ALL');
            const [db, setDb] = useState(null);
            const [teamMembers, setTeamMembers] = useState(['ë¯¸ì§€ì •']); 

            const [configModalOpen, setConfigModalOpen] = useState(false);
            const [firebaseConfigStr, setFirebaseConfigStr] = useState('');
            const [geminiApiKey, setGeminiApiKey] = useState('');
            const [userName, setUserName] = useState('PM Manager'); 
            
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [editingProject, setEditingProject] = useState(null);
            const [previewImage, setPreviewImage] = useState(null);
            
            // Profitability State
            const [targetCost, setTargetCost] = useState('');
            const [targetPrice, setTargetPrice] = useState('');

            const [isUrgentFilterActive, setIsUrgentFilterActive] = useState(false);
            const [isMyProjectFilterActive, setIsMyProjectFilterActive] = useState(false);

            const [rightPanelTab, setRightPanelTab] = useState('ai'); 
            const [aiLoading, setAiLoading] = useState(false);
            const [aiResult, setAiResult] = useState('');
            const [historyLogs, setHistoryLogs] = useState([]); 
            const [comments, setComments] = useState([]);
            const [commentInput, setCommentInput] = useState('');
            const [replyingTo, setReplyingTo] = useState(null);
            const chatEndRef = useRef(null);
            
            const urgentProjects = useMemo(() => projects.filter(p => p.isUrgent), [projects]);

            const filteredProjects = useMemo(() => projects.filter(p => {
                const brandMatch = selectedBrand === 'ALL' ? true : p.brand === selectedBrand;
                const urgentMatch = isUrgentFilterActive ? p.isUrgent : true;
                const myProjectMatch = isMyProjectFilterActive ? p.assignee === userName : true; 
                return brandMatch && urgentMatch && myProjectMatch;
            }), [projects, selectedBrand, isUrgentFilterActive, isMyProjectFilterActive, userName]);
            
            const margin = useMemo(() => calculateMargin(targetPrice, targetCost), [targetPrice, targetCost]);

            useEffect(() => {
                const savedConfig = localStorage.getItem('beauty_roadmap_config_v2');
                if (savedConfig) {
                    try { const config = JSON.parse(savedConfig); initFirebase(config, setDb, setMode, setProjects, setTeamMembers); setFirebaseConfigStr(JSON.stringify(config, null, 2)); } 
                    catch (e) { initLocal(setMode, setProjects, setTeamMembers); }
                } else initLocal(setMode, setProjects, setTeamMembers);
                
                const savedKey = localStorage.getItem('beauty_roadmap_gemini_key');
                if (savedKey) setGeminiApiKey(savedKey);
                const savedName = localStorage.getItem('beauty_roadmap_username');
                if (savedName) setUserName(savedName);
            }, []);

            // Fetch logs/comments when editing a project
            useEffect(() => {
                if (editingProject) {
                    setPreviewImage(editingProject.image);
                    setTargetPrice(editingProject.targetPrice);
                    setTargetCost(editingProject.targetCost);
                    setRightPanelTab('ai'); // Default to AI
                    fetchHistoryLogs(editingProject.id, mode, db, setHistoryLogs);
                    const unsub = fetchComments(editingProject.id, mode, db, setComments);
                    return () => unsub && unsub();
                } else {
                    setHistoryLogs([]); setComments([]); setTargetPrice(''); setTargetCost(''); setPreviewImage(null);
                }
            }, [editingProject, mode, db]);

            useEffect(() => { if (rightPanelTab === 'comments' && chatEndRef.current) chatEndRef.current.scrollIntoView({ behavior: "smooth" }); }, [comments, rightPanelTab]);

            const handleConfigClear = () => {
                if (!confirm('ì •ë§ ëª¨ë“  ì„¤ì •ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? \nì €ì¥ëœ API í‚¤ì™€ ì‚¬ìš©ì ì´ë¦„ì´ ì‚­ì œë©ë‹ˆë‹¤.')) return;
                localStorage.removeItem('beauty_roadmap_config_v2');
                localStorage.removeItem('beauty_roadmap_gemini_key');
                localStorage.removeItem('beauty_roadmap_username');
                alert('ì„¤ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                window.location.reload();
            };

            const handleConfigSaveWrapper = async () => {
                const newName = userName.trim() || 'PM Manager';
                setUserName(newName); 
                localStorage.setItem('beauty_roadmap_gemini_key', geminiApiKey.trim());
                localStorage.setItem('beauty_roadmap_username', newName);
                
                const currentTeam = [...teamMembers];
                if(!currentTeam.includes(newName)) {
                    const newTeam = [...currentTeam, newName].sort();
                    setTeamMembers(newTeam);
                    localStorage.setItem('beauty_roadmap_team', JSON.stringify(newTeam));
                    if (mode === 'firebase' && db) db.collection('team_members').doc(newName).set({ active: true });
                }

                let configStr = firebaseConfigStr.trim();
                if (!configStr) { window.location.reload(); return; }
                if (configStr.includes('=')) configStr = configStr.substring(configStr.indexOf('=') + 1);
                if (configStr.endsWith(';')) configStr = configStr.slice(0, -1);
                try {
                    const fn = new Function(`return ${configStr}`);
                    const config = fn();
                    if (!config.apiKey) throw new Error("í•„ìˆ˜ ì •ë³´ ëˆ„ë½");
                    localStorage.setItem('beauty_roadmap_config_v2', JSON.stringify(config));
                    window.location.reload();
                } catch (e) { alert("ì„¤ì • ì˜¤ë¥˜: " + e.message); }
            };
            
            // --- AI Logic (Gemini API) ---
            const callGemini = async (mode, brand, name, category, stage, month, day) => {
                if (!geminiApiKey) { alert("ì‹œìŠ¤í…œ ì„¤ì •ì—ì„œ Gemini API í‚¤ë¥¼ ë¨¼ì € ë“±ë¡í•´ì£¼ì„¸ìš”."); return; }
                setAiLoading(true);
                setRightPanelTab('ai');
                
                const brandInfo = BRANDS[brand] || {};
                const brandIdentity = brandInfo.identity || "í™”ì¥í’ˆ ë¸Œëœë“œ";
                const targetDate = `${month}ì›” ${day}ì¼`;
                const persona = "ë‹¹ì‹ ì€ í™”ì¥í’ˆ ê°œë°œ/ë§ˆì¼€íŒ… ì „ë¬¸ê°€ì…ë‹ˆë‹¤. í‚¤ì¦ˆí…(ì–´ë¦°ì´), ì•„í† íì–´(ë”ë§ˆ), ì…€ë ˆë°”(ì•ˆí‹°ì—ì´ì§•), ë´„ë¹„ìœ (íƒˆëª¨í—¤ì–´) ë“± ê° ë¸Œëœë“œì˜ íŠ¹ì„±ì„ ê¹Šì´ ì´í•´í•˜ê³  ìˆìŠµë‹ˆë‹¤. ";
                
                let prompt = "";
                if (mode === 'back_schedule') prompt = `${persona} í˜„ì¬ '${brand}' ë¸Œëœë“œì˜ ì‹ ì œí’ˆ '${name}'(${category})ì„ ê¸°íš ì¤‘ì…ë‹ˆë‹¤. ë¸Œëœë“œ ì •ì²´ì„±: ${brandIdentity}. ëª©í‘œ ëŸ°ì¹­ì¼ì€ 2026ë…„ ${targetDate}ì…ë‹ˆë‹¤. í˜„ì¬ ë‹¨ê³„ëŠ” '${stage}' ì…ë‹ˆë‹¤. ì„±ê³µì ì¸ ëŸ°ì¹­ì„ ìœ„í•´ ì˜¤ëŠ˜ë¶€í„° ëŸ°ì¹­ì¼ê¹Œì§€ì˜ D-Dayë³„ ì—­ì‚° ìŠ¤ì¼€ì¤„ì„ í•µì‹¬ ë§ˆì¼ìŠ¤í†¤ ìœ„ì£¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.`;
                else if (mode === 'risk_scan') prompt = `${persona} '${brand}' ë¸Œëœë“œì˜ '${name}'(${category}) ì œí’ˆì„ 2026ë…„ ${targetDate}ì— ëŸ°ì¹­í•˜ë ¤ í•©ë‹ˆë‹¤. ì´ ì‹œê¸°ì˜ ê³„ì ˆì  ì´ìŠˆ, ì—°íœ´(ì„¤ë‚ /ì¶”ì„ ë“±), í™”ì¥í’ˆ ì‹œì¥ íŠ¸ë Œë“œ, ê·¸ë¦¬ê³  ${brand} ë¸Œëœë“œê°€ ì£¼ì˜í•´ì•¼ í•  ì ì„ ê³ ë ¤í•˜ì—¬ ì˜ˆìƒë˜ëŠ” 'í•µì‹¬ ë¦¬ìŠ¤í¬ 3ê°€ì§€'ì™€ 'ëŒ€ì‘ ë°©ì•ˆ'ì„ ì•Œë ¤ì£¼ì„¸ìš”.`;
                else if (mode === 'checklist') prompt = `${persona} í˜„ì¬ '${brand}' ë¸Œëœë“œì˜ '${name}' ì œí’ˆì´ '${stage}' ë‹¨ê³„ì— ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°€ê¸° ìœ„í•´ PMì´ ì§€ê¸ˆ ë‹¹ì¥ í™•ì¸í•´ì•¼ í•  'í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ 5ê°€ì§€'ë¥¼ ìš°ì„ ìˆœìœ„ëŒ€ë¡œ ë‚˜ì—´í•´ì£¼ì„¸ìš”.`;

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${geminiApiKey}`, {
                        method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });
                    const data = await response.json();
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text || "AI ì‘ë‹µì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                    setAiResult(text);
                } catch (e) { setAiResult("AI í˜¸ì¶œ ì˜¤ë¥˜. API í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”."); } finally { setAiLoading(false); }
            };

            const saveProject = async (data) => {
                const projectData = { ...data, updatedAt: new Date().toISOString() };
                const isNew = !editingProject;

                // Log History
                if (!isNew) {
                    if (editingProject.stage !== data.stage) await addHistoryLog(editingProject.id, data.name, 'ë‹¨ê³„ ë³€ê²½', `${editingProject.stage} â” ${data.stage}`, userName, mode, db, setHistoryLogs);
                    if (editingProject.name !== data.name) await addHistoryLog(editingProject.id, data.name, 'ì œí’ˆëª… ë³€ê²½', `${editingProject.name} â” ${data.name}`, userName, mode, db, setHistoryLogs);
                    if (editingProject.targetPrice !== data.targetPrice) await addHistoryLog(editingProject.id, data.name, 'ê°€ê²© ë³€ê²½', `${editingProject.targetPrice} â” ${data.targetPrice}`, userName, mode, db, setHistoryLogs);
                } 

                if (mode === 'firebase' && db) {
                    if (editingProject) await db.collection('projects').doc(editingProject.id).update(projectData);
                    else {
                        const ref = await db.collection('projects').add(projectData);
                        await addHistoryLog(ref.id, data.name, 'í”„ë¡œì íŠ¸ ìƒì„±', 'ì‹ ê·œ ë“±ë¡', userName, mode, db, setHistoryLogs);
                    }
                } else {
                    let newProjects;
                    if (editingProject) newProjects = projects.map(p => p.id === editingProject.id ? { ...p, ...projectData } : p);
                    else {
                        const newId = Date.now().toString();
                        newProjects = [...projects, { id: newId, ...projectData }];
                        await addHistoryLog(newId, data.name, 'í”„ë¡œì íŠ¸ ìƒì„±', 'ì‹ ê·œ ë“±ë¡', userName, mode, db, setHistoryLogs);
                    }
                    setProjects(newProjects);
                    localStorage.setItem('beauty_roadmap_data', JSON.stringify(newProjects));
                }
                setIsModalOpen(false);
                setEditingProject(null);
                setAiResult('');
            };

             const deleteProject = async () => {
                if (!editingProject || !confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
                if (mode === 'firebase' && db) await db.collection('projects').doc(editingProject.id).delete();
                else {
                    const newProjects = projects.filter(p => p.id !== editingProject.id);
                    setProjects(newProjects);
                    localStorage.setItem('beauty_roadmap_data', JSON.stringify(newProjects));
                }
                setIsModalOpen(false);
            };

            return (
                <div className="flex h-screen bg-slate-50">
                    {/* Sidebar */}
                    <div className="w-64 bg-white border-r border-slate-200 flex flex-col shrink-0 z-50 h-full relative">
                        <div className="p-6 border-b border-slate-100 shrink-0">
                            <h1 className="text-xl font-extrabold text-slate-900 tracking-tight"><span className="text-blue-600">Beauty PM</span><br/>Scheduler</h1>
                            <div className={`mt-2 text-[10px] px-2 py-0.5 rounded-full inline-block uppercase tracking-wider ${mode === 'local' ? 'bg-slate-100 text-slate-500' : 'bg-green-100 text-green-700'}`}>{mode === 'local' ? 'Local Mode' : 'Team Sync'}</div>
                        </div>
                        <nav className="flex-1 p-4 space-y-2 overflow-y-auto custom-scrollbar">
                            <div className="text-[10px] font-bold text-slate-400 uppercase tracking-wider px-4 mb-2 mt-2">DASHBOARD</div>
                            <button onClick={() => setView('gantt')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-bold transition ${view === 'gantt' ? 'bg-blue-50 text-blue-700' : 'text-slate-500 hover:bg-slate-50'}`}><Icons.Layout /> ì „ì²´ ë¡œë“œë§µ (Gantt)</button>
                            <button onClick={() => setView('calendar')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-bold transition ${view === 'calendar' ? 'bg-blue-50 text-blue-700' : 'text-slate-500 hover:bg-slate-50'}`}><Icons.Calendar /> ì›”ë³„ ìº˜ë¦°ë” (Calendar)</button>
                            
                            <div className="text-[10px] font-bold text-slate-400 uppercase tracking-wider px-4 mb-2 mt-6">UTILITY</div>
                            <button onClick={() => setView('tools')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-bold transition ${view === 'tools' ? 'bg-indigo-50 text-indigo-700' : 'text-slate-500 hover:bg-slate-50'}`}><Icons.Calculator /> ë·°í‹° ì‹¤ë¬´ íˆ´</button>
                            <button onClick={() => setView('marketing')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-bold transition ${view === 'marketing' ? 'bg-indigo-50 text-indigo-700' : 'text-slate-500 hover:bg-slate-50'}`}><Icons.Target /> ë§ˆì¼€íŒ… D-Day</button>
                        </nav>
                        <div className="shrink-0 bg-white border-t border-slate-100 z-50 sidebar-footer">
                             <ClockWidget />
                             <div className="p-4 pt-2">
                                <button onClick={() => setConfigModalOpen(true)} className="w-full flex items-center justify-center gap-2 px-4 py-3 bg-white border-2 border-slate-200 hover:border-blue-500 hover:text-blue-600 text-slate-600 rounded-xl transition text-sm font-bold shadow-sm cursor-pointer settings-btn"><Icons.Settings /> ì‹œìŠ¤í…œ ì„¤ì •</button>
                            </div>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="flex-1 flex flex-col overflow-hidden">
                        <header className="bg-white border-b shadow-sm flex flex-col shrink-0 z-20">
                            <div className="px-6 py-3 flex justify-between items-center">
                                <h2 className="font-bold text-slate-700 text-lg">
                                    {view === 'gantt' && 'ì „ì²´ ë¡œë“œë§µ'}
                                    {view === 'calendar' && 'ì›”ë³„ ìº˜ë¦°ë”'}
                                    {view === 'tools' && 'ë·°í‹° ì‹¤ë¬´ íˆ´'}
                                    {view === 'marketing' && 'ë§ˆì¼€íŒ… D-Day ìŠ¤ì¼€ì¤„ëŸ¬'}
                                </h2>
                                <button onClick={() => { setEditingProject(null); setIsModalOpen(true); setAiResult(''); }} className="bg-slate-900 hover:bg-slate-800 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 shadow-lg transition transform hover:scale-105"><Icons.Plus /> ì¼ì • ë“±ë¡</button>
                            </div>
                            <div className="border-t transition-colors duration-300 px-6 py-2 flex items-center gap-3 overflow-hidden bg-slate-50 border-slate-100">
                                <button onClick={() => setIsUrgentFilterActive(!isUrgentFilterActive)} className={`flex-shrink-0 flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-bold transition-all shadow-sm border ${isUrgentFilterActive ? 'bg-red-600 text-white border-red-700 shadow-md ring-2 ring-red-200' : 'bg-white text-red-600 border-red-200 hover:bg-red-50'}`}><Icons.Siren width={14} height={14} /><span>{isUrgentFilterActive ? 'ê¸´ê¸‰ í•„í„° í•´ì œ' : 'ê¸´ê¸‰ ì´ìŠˆë§Œ ë³´ê¸°'}</span></button>
                                <button onClick={() => setIsMyProjectFilterActive(!isMyProjectFilterActive)} className={`flex-shrink-0 flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-bold transition-all shadow-sm border ${isMyProjectFilterActive ? 'bg-blue-600 text-white border-blue-700 shadow-md ring-2 ring-blue-200' : 'bg-white text-blue-600 border-blue-200 hover:bg-blue-50'}`}><Icons.User width={14} height={14} /><span>{isMyProjectFilterActive ? 'ì „ì²´ ë³´ê¸°' : `ë‚´ ë‹´ë‹¹ë§Œ ë³´ê¸° (${userName})`}</span></button>
                                <div className="h-4 w-px bg-slate-300 mx-1"></div>
                                {/* Restored Urgent Ticker - Added Image Support */}
                                <div className="flex gap-2 overflow-x-auto no-scrollbar items-center flex-1 mask-image-linear">
                                    {urgentProjects.map(p => {
                                        const brandInfo = getBrand(p.brand);
                                        return (
                                            <div key={p.id} onClick={() => { setEditingProject(p); setIsModalOpen(true); }} className="flex items-center gap-2 bg-white/80 backdrop-blur-sm px-2 py-1 rounded border border-red-100 cursor-pointer hover:bg-white transition shrink-0 group shadow-sm">
                                                {p.image && <div className="w-4 h-4 rounded-full bg-cover bg-center border border-slate-100" style={{backgroundImage: `url(${p.image})`}}></div>}
                                                <span className={`w-1.5 h-1.5 rounded-full ${brandInfo.dot}`}></span><span className="text-xs font-bold text-slate-700 group-hover:text-red-700 transition-colors">{p.name}</span><span className="text-[10px] font-bold text-red-500 bg-red-50 px-1 rounded">{p.targetMonth}.{p.targetDay || '?'}</span>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </header>

                        <main className="flex-1 overflow-auto p-6 bg-slate-50/50">
                            {view === 'gantt' && (
                                <>
                                    {selectedBrand === 'ALL' && <Dashboard projects={filteredProjects} />}
                                    <div className="flex gap-2 overflow-x-auto pb-4 no-scrollbar mb-2">
                                        <button onClick={() => setSelectedBrand('ALL')} className={`px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap transition shadow-sm ${selectedBrand === 'ALL' ? 'bg-slate-800 text-white' : 'bg-white border border-slate-200 text-slate-600 hover:bg-slate-50'}`}>All Brands</button>
                                        {Object.entries(BRANDS).map(([key, b]) => (
                                            <button key={key} onClick={() => setSelectedBrand(key)} className={`px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap flex items-center gap-2 transition shadow-sm ${selectedBrand === key ? 'bg-white ring-2 ring-slate-800 text-slate-900' : 'bg-white border border-slate-200 text-slate-500 hover:bg-slate-50'}`}><span className={`w-2 h-2 rounded-full ${b.dot}`}></span> {b.name}</button>
                                        ))}
                                    </div>
                                    <div className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden p-6">
                                        <div className="grid grid-cols-12 gap-0 mb-6 border-b border-slate-100 pb-2">{Array.from({length: 12}, (_, i) => i + 1).map(m => <div key={m} className="text-center text-sm font-bold text-slate-400">{m}ì›”</div>)}</div>
                                        {Object.entries(BRANDS).map(([key, brand]) => {
                                            if (selectedBrand !== 'ALL' && selectedBrand !== key) return null;
                                            const brandProjects = filteredProjects.filter(p => p.brand === key);
                                            if (brandProjects.length === 0 && (isUrgentFilterActive || isMyProjectFilterActive)) return null; 
                                            return (
                                                <div key={key} className="mb-8 last:mb-0">
                                                    <div className="flex items-center gap-2 mb-3 px-1"><span className={`w-2 h-2 rounded-full ${brand.dot}`}></span><h3 className="font-bold text-slate-800 text-sm tracking-wide">{brand.name}</h3></div>
                                                    <div className={`grid grid-cols-12 gap-0 rounded-xl overflow-hidden border border-slate-100 ${brand.bg}`}>
                                                        {Array.from({length: 12}, (_, i) => i + 1).map(m => (
                                                            <div key={m} className="relative p-1 min-h-[90px] border-r border-slate-200/50 last:border-0 hover:bg-white/40 transition">
                                                                {brandProjects.filter(p => p.targetMonth === m).sort((a, b) => (a.targetDay || 99) - (b.targetDay || 99)).map(p => {
                                                                    const StageIcon = STAGE_ICONS[p.stage] || Icons.ClipboardCheck;
                                                                    return (
                                                                        <div key={p.id} onClick={() => { setEditingProject(p); setIsModalOpen(true); setAiResult(''); }} className={`group bg-white p-2.5 rounded-lg shadow-sm cursor-pointer hover:shadow-md transition relative top-0 hover:-top-1 mb-2 ${p.isUrgent ? 'urgent-card' : 'border border-slate-200'}`}>
                                                                            <div className="flex justify-between items-center mb-1.5">
                                                                                <span className="text-[10px] font-bold text-slate-500 bg-slate-100 px-1.5 py-0.5 rounded">{m}.{p.targetDay || '?'}</span>
                                                                                <div className="flex gap-1">
                                                                                    {p.assignee && <span className="text-[9px] font-bold text-slate-600 bg-slate-200 px-1.5 py-0.5 rounded">{p.assignee}</span>}
                                                                                    {p.isUrgent && <span className="text-[9px] font-bold text-white bg-red-500 px-1.5 py-0.5 rounded-full animate-pulse">ê¸´ê¸‰</span>}
                                                                                </div>
                                                                            </div>
                                                                            {/* Image Rendering Logic - RESTORED & ENHANCED */}
                                                                            {p.image && <div className="w-full h-16 bg-cover bg-center rounded-md mb-2 border border-slate-100" style={{ backgroundImage: `url(${p.image})` }}></div>}
                                                                            
                                                                            <div className={`text-xs font-bold leading-snug mb-2 line-clamp-2 ${p.isUrgent ? 'text-red-900' : 'text-slate-800'}`}>{p.name}</div>
                                                                             {/* Restored Details in Card */}
                                                                            {p.targetPrice && <div className="mt-1 text-[9px] font-bold text-blue-600 flex items-center gap-0.5"><Icons.DollarSign width={8} height={8} /> â‚©{p.targetPrice}</div>}
                                                                            <div className="flex justify-between items-center mt-auto"><span className={`text-[9px] px-1.5 py-0.5 rounded font-bold flex items-center gap-1 ${STAGES.find(s=>s.id===p.stage)?.color}`}><StageIcon width={10} height={10} />{STAGES.find(s=>s.id===p.stage)?.label.split('.')[1]}</span></div>
                                                                        </div>
                                                                    );
                                                                })}
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </>
                            )}
                            
                            {view === 'calendar' && <CalendarView projects={filteredProjects} onEdit={(p) => { setEditingProject(p); setIsModalOpen(true); setAiResult(''); }} onDragEnd={(id, d, m, y) => { /* Update Logic Omitted for Brevity */ }} />}
                            
                            {view === 'tools' && <BeautyTools />}
                            
                            {view === 'marketing' && <MarketingDDay />}
                        </main>
                    </div>

                    {/* Edit/Add Modal - Restored All Fields */}
                    {isModalOpen && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex justify-center items-center z-[9999] p-4 fade-in">
                            <div className="bg-white rounded-2xl shadow-2xl w-full max-w-6xl overflow-hidden flex flex-col md:flex-row h-[85vh] relative">
                                <button onClick={() => setIsModalOpen(false)} className="absolute top-2 right-2 p-2 bg-white rounded-full shadow-lg z-[110] text-slate-500 hover:text-red-500"><Icons.X /></button>
                                <div className="w-full md:w-[350px] flex flex-col border-r border-slate-100 bg-white shrink-0">
                                    <div className="px-6 py-5 border-b flex justify-between items-center bg-white shrink-0">
                                        <div><h2 className="text-lg font-bold text-slate-900">{editingProject ? 'ì¼ì • ìƒì„¸ ìˆ˜ì •' : 'ì‹ ê·œ ì¼ì • ë“±ë¡'}</h2><p className="text-xs text-slate-400 mt-0.5">ì •í™•í•œ ë‚ ì§œì™€ ë‹´ë‹¹ìë¥¼ ì§€ì •í•˜ì„¸ìš”</p></div>
                                    </div>
                                    <div className="p-6 overflow-y-auto custom-scrollbar flex-1">
                                        <form id="projectForm" onSubmit={(e) => {
                                            e.preventDefault();
                                            const fd = new FormData(e.target);
                                            saveProject({ 
                                                brand: fd.get('brand'), name: fd.get('name'), category: fd.get('category'), 
                                                targetMonth: parseInt(fd.get('targetMonth')), targetDay: fd.get('targetDay') ? parseInt(fd.get('targetDay')) : null,
                                                targetYear: parseInt(fd.get('targetYear')), stage: fd.get('stage'), isUrgent: fd.get('isUrgent') === 'on',
                                                memo: fd.get('memo'), vendor: fd.get('vendor'), packaging: fd.get('packaging'),
                                                functional: fd.get('functional'), clinical: fd.get('clinical'), vegan: fd.get('vegan'),
                                                targetPrice: fd.get('targetPrice'), targetCost: fd.get('targetCost'),
                                                sampleRound: fd.get('sampleRound'), isSampleConfirmed: fd.get('isSampleConfirmed') === 'on',
                                                specTarget: fd.get('specTarget'), specConcept: fd.get('specConcept'), specVolume: fd.get('specVolume'), specIngredients: fd.get('specIngredients'),
                                                image: fd.get('image'), assignee: fd.get('assignee')
                                            });
                                        }} className="space-y-5">
                                            <div className="bg-red-50 p-3 rounded-lg border border-red-100 flex items-center justify-between"><label className="text-sm font-bold text-red-700 flex items-center gap-2 cursor-pointer select-none"><Icons.Siren /> ê¸´ê¸‰ / ì¤‘ìš” í”„ë¡œì íŠ¸</label><input type="checkbox" name="isUrgent" defaultChecked={editingProject?.isUrgent} className="w-5 h-5 accent-red-600 cursor-pointer" /></div>
                                            
                                            {/* Image Input */}
                                            <div>
                                                <label className="block text-xs font-bold mb-1.5 text-slate-400 uppercase tracking-wider flex items-center gap-1"><Icons.Image width={12} height={12} /> Image URL</label>
                                                <input name="image" value={previewImage || ''} onChange={(e) => setPreviewImage(e.target.value)} placeholder="https://example.com/image.jpg" className="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm outline-none" />
                                                {previewImage && <div className="mt-2 w-full h-32 bg-slate-50 rounded-lg border border-slate-200 bg-cover bg-center" style={{backgroundImage: `url(${previewImage})`}}></div>}
                                            </div>

                                            <div><label className="block text-xs font-bold mb-2 text-slate-400 uppercase tracking-wider">Target Brand</label><div className="grid grid-cols-2 gap-2">{Object.entries(BRANDS).map(([key, b]) => (<label key={key} className="cursor-pointer group relative"><input type="radio" name="brand" value={key} defaultChecked={editingProject ? editingProject.brand === key : key === 'KIDSTEN'} className="peer sr-only" /><div className="peer-checked:ring-2 ring-slate-900 peer-checked:bg-slate-50 rounded-xl p-3 border border-slate-200 flex flex-col items-center justify-center gap-1 hover:bg-slate-50 transition h-full"><span className={`w-2 h-2 rounded-full ${b.dot}`}></span><span className="text-xs font-bold text-slate-700">{b.name}</span></div></label>))}</div></div>
                                            <div><label className="block text-xs font-bold mb-1.5 text-slate-400 uppercase tracking-wider">Product Name</label><input required name="name" defaultValue={editingProject?.name} placeholder="ì˜ˆ: ì‹œì¹´ ë¦´ë¦¬í”„ í¬ë¦¼" className="w-full border border-slate-200 rounded-lg px-3 py-2.5 outline-none focus:ring-2 focus:ring-blue-500/20 text-sm font-medium" /></div>
                                            
                                            <div className="grid grid-cols-3 gap-3">
                                                <div><label className="block text-xs font-bold mb-1.5 text-slate-400 uppercase tracking-wider">Launch Year</label><select name="targetYear" defaultValue={editingProject?.targetYear || 2026} className="w-full border border-slate-200 rounded-lg px-3 py-2.5 bg-white text-sm outline-none">{Array.from({length: 6}, (_, i) => 2025 + i).map(y => <option key={y} value={y}>{y}ë…„</option>)}</select></div>
                                                <div><label className="block text-xs font-bold mb-1.5 text-slate-400 uppercase tracking-wider">Month</label><select name="targetMonth" defaultValue={editingProject?.targetMonth || (new Date().getMonth() + 1)} className="w-full border border-slate-200 rounded-lg px-3 py-2.5 bg-white text-sm outline-none">{Array.from({length: 12}, (_, i) => i + 1).map(m => <option key={m} value={m}>{m}ì›”</option>)}</select></div>
                                                <div><label className="block text-xs font-bold mb-1.5 text-slate-400 uppercase tracking-wider">Day <span className="text-red-500">*</span></label><input required type="number" min="1" max="31" name="targetDay" defaultValue={editingProject?.targetDay || new Date().getDate()} className="w-full border border-slate-200 rounded-lg px-3 py-2.5 outline-none focus:ring-2 focus:ring-blue-500/20 text-sm" /></div>
                                            </div>
                                            
                                            <div><label className="block text-xs font-bold mb-1.5 text-slate-400 uppercase tracking-wider">Category</label><select name="category" defaultValue={editingProject?.category || 'Skincare'} className="w-full border border-slate-200 rounded-lg px-3 py-2.5 bg-white text-sm outline-none"><option value="Skincare">ìŠ¤í‚¨ì¼€ì–´</option><option value="Cleanser">í´ë Œì§•</option><option value="Sun Care">ì„ ì¼€ì–´</option><option value="Makeup">ë©”ì´í¬ì—…</option><option value="Hair/Body">í—¤ì–´/ë°”ë””</option></select></div>
                                            <div><label className="block text-xs font-bold mb-1.5 text-slate-400 uppercase tracking-wider">Assignee</label><select name="assignee" defaultValue={editingProject?.assignee || 'ë¯¸ì§€ì •'} className="w-full border border-slate-200 rounded-lg px-3 py-2.5 bg-white text-sm outline-none">{teamMembers.map(m => <option key={m} value={m}>{m}</option>)}</select></div>
                                            
                                            {/* Profitability Analysis */}
                                            <div className="bg-slate-50 p-3 rounded-lg border border-slate-200">
                                                <label className="block text-xs font-bold mb-2 text-slate-500 uppercase flex items-center gap-1"><Icons.PieChart width={12} height={12} /> Profitability Analysis</label>
                                                <div className="grid grid-cols-2 gap-3 mb-2">
                                                    <div><label className="block text-[10px] font-bold text-slate-400 mb-1">Target Cost (ì›ê°€)</label><input name="targetCost" type="number" value={targetCost} onChange={(e) => setTargetCost(e.target.value)} placeholder="5000" className="w-full border border-slate-200 rounded-md px-2 py-1.5 text-xs" /></div>
                                                    <div><label className="block text-[10px] font-bold text-slate-400 mb-1">Retail Price (ì†Œë¹„ìê°€)</label><input name="targetPrice" type="number" value={targetPrice} onChange={(e) => setTargetPrice(e.target.value)} placeholder="32000" className="w-full border border-slate-200 rounded-md px-2 py-1.5 text-xs" /></div>
                                                </div>
                                                <div className="flex justify-between items-center pt-2 border-t border-slate-200 mt-2"><span className="text-xs font-bold text-slate-500">Margin Rate</span><span className={`text-sm font-black ${margin >= 70 ? 'text-emerald-600' : (margin >= 50 ? 'text-blue-600' : 'text-red-500')}`}>{margin}%</span></div>
                                            </div>

                                            {/* Product Specs */}
                                            <div>
                                                <label className="block text-xs font-bold mb-2 text-slate-400 uppercase tracking-wider flex items-center gap-1"><Icons.Tag width={12} height={12} /> Product Spec</label>
                                                <div className="space-y-2">
                                                    <input name="specTarget" defaultValue={editingProject?.specTarget} placeholder="íƒ€ê²Ÿ ê³ ê° (ì˜ˆ: 2030 ë¯¼ê°ì„±)" className="w-full border border-slate-200 rounded-lg px-3 py-2 text-xs" />
                                                    <input name="specConcept" defaultValue={editingProject?.specConcept} placeholder="í•µì‹¬ ì»¨ì…‰ (ì˜ˆ: 3ì´ˆ ì§„ì •)" className="w-full border border-slate-200 rounded-lg px-3 py-2 text-xs" />
                                                    <div className="grid grid-cols-2 gap-2">
                                                        <input name="specVolume" defaultValue={editingProject?.specVolume} placeholder="ìš©ëŸ‰/ì œí˜•" className="w-full border border-slate-200 rounded-lg px-3 py-2 text-xs" />
                                                        <input name="specIngredients" defaultValue={editingProject?.specIngredients} placeholder="ì£¼ìš” ì„±ë¶„" className="w-full border border-slate-200 rounded-lg px-3 py-2 text-xs" />
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Vendor & Packaging */}
                                            <div className="grid grid-cols-2 gap-3">
                                                <div><label className="block text-xs font-bold mb-1.5 text-slate-400 uppercase tracking-wider flex items-center gap-1"><Icons.Factory width={12} height={12} /> Manufacturer</label><input name="vendor" defaultValue={editingProject?.vendor} placeholder="ì˜ˆ: ì½”ìŠ¤ë§¥ìŠ¤" className="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm" /></div>
                                                <div><label className="block text-xs font-bold mb-1.5 text-slate-400 uppercase tracking-wider flex items-center gap-1"><Icons.Package width={12} height={12} /> Packaging</label><input name="packaging" defaultValue={editingProject?.packaging} placeholder="ì˜ˆ: ì—°ìš°" className="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm" /></div>
                                            </div>

                                            {/* Sample & Regulations */}
                                            <div className="bg-purple-50 p-3 rounded-lg border border-purple-100">
                                                <div className="flex justify-between items-center mb-2"><label className="text-xs font-bold text-purple-800 uppercase flex items-center gap-1"><Icons.Beaker width={12} height={12} /> Sample Tracking</label></div>
                                                <div className="flex gap-3 items-center">
                                                    <select name="sampleRound" defaultValue={editingProject?.sampleRound || '1ì°¨'} className="flex-1 border border-purple-200 rounded-lg px-2 py-1.5 text-xs bg-white"><option value="1ì°¨">1ì°¨ ìƒ˜í”Œ</option><option value="2ì°¨">2ì°¨ ìƒ˜í”Œ</option><option value="3ì°¨">3ì°¨ ìƒ˜í”Œ</option><option value="ìµœì¢…">ìµœì¢… ìƒ˜í”Œ</option></select>
                                                    <div className="flex items-center gap-2"><input type="checkbox" name="isSampleConfirmed" defaultChecked={editingProject?.isSampleConfirmed} id="sampleConfirmed" className="w-4 h-4 accent-purple-600 rounded cursor-pointer" /><label htmlFor="sampleConfirmed" className="text-xs font-bold text-purple-700 cursor-pointer select-none">ìµœì¢… í™•ì •</label></div>
                                                </div>
                                            </div>

                                            <div className="bg-slate-50 p-3 rounded-lg border border-slate-200">
                                                <label className="block text-xs font-bold mb-2 text-slate-500 uppercase flex items-center gap-1"><Icons.ClipboardCheck width={12} height={12} /> Regulation Status</label>
                                                <div className="grid grid-cols-3 gap-2">
                                                    <div><label className="block text-[10px] font-bold text-slate-400 mb-1">ê¸°ëŠ¥ì„± ë³´ê³ </label><select name="functional" defaultValue={editingProject?.functional || 'none'} className="w-full border border-slate-200 rounded-md px-2 py-1.5 text-xs bg-white">{STATUS_OPTIONS.functional.map(o => <option key={o.value} value={o.value}>{o.label}</option>)}</select></div>
                                                    <div><label className="block text-[10px] font-bold text-slate-400 mb-1">ì„ìƒ ì‹œí—˜</label><select name="clinical" defaultValue={editingProject?.clinical || 'none'} className="w-full border border-slate-200 rounded-md px-2 py-1.5 text-xs bg-white">{STATUS_OPTIONS.clinical.map(o => <option key={o.value} value={o.value}>{o.label}</option>)}</select></div>
                                                    <div><label className="block text-[10px] font-bold text-slate-400 mb-1">ë¹„ê±´ ì¸ì¦</label><select name="vegan" defaultValue={editingProject?.vegan || 'none'} className="w-full border border-slate-200 rounded-md px-2 py-1.5 text-xs bg-white">{STATUS_OPTIONS.vegan.map(o => <option key={o.value} value={o.value}>{o.label}</option>)}</select></div>
                                                </div>
                                            </div>

                                            <div><label className="block text-xs font-bold mb-2 text-slate-400 uppercase tracking-wider">Current Stage</label><div className="space-y-1.5">{STAGES.map(s => (<label key={s.id} className="flex items-center gap-3 p-2.5 border border-slate-100 rounded-lg hover:bg-slate-50 cursor-pointer transition"><input type="radio" name="stage" value={s.id} defaultChecked={editingProject ? editingProject.stage === s.id : s.id === 'planning'} className="accent-slate-900 w-4 h-4" /><span className={`text-[11px] px-2 py-0.5 rounded font-bold ${s.color}`}>{s.label}</span></label>))}</div></div>
                                            <div><label className="block text-xs font-bold mb-1.5 text-slate-400 uppercase tracking-wider flex items-center gap-1"><Icons.FileText width={12} height={12} /> Memo / Issue Tracking</label><textarea name="memo" defaultValue={editingProject?.memo} placeholder="í”„ë¡œì íŠ¸ íŠ¹ì´ì‚¬í•­, ì§€ì—° ì‚¬ìœ  ë“±..." className="w-full h-24 border border-slate-200 rounded-lg px-3 py-2.5 outline-none focus:ring-2 focus:ring-blue-500/20 text-sm bg-yellow-50/50 resize-none"></textarea></div>
                                        </form>
                                    </div>
                                    <div className="p-4 border-t bg-slate-50 flex gap-2 shrink-0">
                                        {editingProject && <button type="button" onClick={deleteProject} className="px-4 py-2.5 bg-white border border-red-200 text-red-600 rounded-lg text-sm font-bold hover:bg-red-50 transition">ì‚­ì œ</button>}
                                        <button type="submit" form="projectForm" className="flex-1 px-4 py-2.5 bg-slate-900 text-white font-bold rounded-lg hover:bg-slate-800 transition shadow-lg shadow-slate-900/10">{editingProject ? 'ìˆ˜ì • ì €ì¥' : 'ìƒˆ ì¼ì • ë“±ë¡'}</button>
                                    </div>
                                </div>
                                
                                <div className="flex-1 bg-slate-50 flex flex-col overflow-hidden relative">
                                    <div className="px-6 py-4 border-b bg-white flex items-center justify-between shrink-0 shadow-sm z-10">
                                        <div className="flex p-1 bg-slate-100 rounded-lg gap-1">
                                            <button onClick={() => setRightPanelTab('ai')} className={`px-3 py-1.5 rounded-md text-xs font-bold flex items-center gap-2 transition ${rightPanelTab === 'ai' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}><Icons.Bot width={14} height={14} /> AI Assistant</button>
                                            <button onClick={() => setRightPanelTab('history')} className={`px-3 py-1.5 rounded-md text-xs font-bold flex items-center gap-2 transition ${rightPanelTab === 'history' ? 'bg-white text-slate-800 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}><Icons.History width={14} height={14} /> History</button>
                                            <button onClick={() => setRightPanelTab('comments')} className={`px-3 py-1.5 rounded-md text-xs font-bold flex items-center gap-2 transition ${rightPanelTab === 'comments' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}><Icons.MessageSquare width={14} height={14} /> Chat</button>
                                        </div>
                                    </div>
                                    <div className="flex-1 overflow-hidden flex flex-col relative">
                                        {rightPanelTab === 'ai' && (
                                            <>
                                                <div className="p-6 grid grid-cols-1 md:grid-cols-3 gap-4 shrink-0">
                                                    <button onClick={() => { const fd = new FormData(document.getElementById('projectForm')); callGemini('back_schedule', fd.get('brand'), fd.get('name'), fd.get('category'), fd.get('stage'), fd.get('targetMonth'), fd.get('targetDay')); }} className="bg-white hover:bg-blue-50 border-2 border-slate-100 hover:border-blue-200 p-4 rounded-xl text-left transition group shadow-sm"><div className="flex items-center gap-2 mb-2"><div className="p-2 bg-blue-100 text-blue-600 rounded-lg group-hover:scale-110 transition"><Icons.Calendar /></div><span className="font-bold text-slate-700 group-hover:text-blue-700">ì •ë°€ ì—­ì‚° ìŠ¤ì¼€ì¤„</span></div><p className="text-xs text-slate-400 group-hover:text-blue-600/70">ì§€ì •ëœ ë‚ ì§œ ê¸°ì¤€<br/>D-Dayë³„ ë§ˆê°ì¼ ê³„ì‚°</p></button>
                                                    <button onClick={() => { const fd = new FormData(document.getElementById('projectForm')); callGemini('risk_scan', fd.get('brand'), fd.get('name'), fd.get('category'), fd.get('stage'), fd.get('targetMonth'), fd.get('targetDay')); }} className="bg-white hover:bg-red-50 border-2 border-slate-100 hover:border-red-200 p-4 rounded-xl text-left transition group shadow-sm"><div className="flex items-center gap-2 mb-2"><div className="p-2 bg-red-100 text-red-600 rounded-lg group-hover:scale-110 transition"><Icons.ShieldAlert /></div><span className="font-bold text-slate-700 group-hover:text-red-700">ê¸´ê¸‰ ë¦¬ìŠ¤í¬ ì§„ë‹¨</span></div><p className="text-xs text-slate-400 group-hover:text-red-600/70">ì—°íœ´, ë¬¼ë¥˜ ì´ìŠˆ ë“±<br/>ë‚ ì§œ ê¸°ë°˜ ìœ„í—˜ ë¶„ì„</p></button>
                                                    <button onClick={() => { const fd = new FormData(document.getElementById('projectForm')); callGemini('checklist', fd.get('brand'), fd.get('name'), fd.get('category'), fd.get('stage'), fd.get('targetMonth'), fd.get('targetDay')); }} className="bg-white hover:bg-emerald-50 border-2 border-slate-100 hover:border-emerald-200 p-4 rounded-xl text-left transition group shadow-sm"><div className="flex items-center gap-2 mb-2"><div className="p-2 bg-emerald-100 text-emerald-600 rounded-lg group-hover:scale-110 transition"><Icons.ListCheck /></div><span className="font-bold text-slate-700 group-hover:text-emerald-700">ë‹¨ê³„ë³„ ì²´í¬ë¦¬ìŠ¤íŠ¸</span></div><p className="text-xs text-slate-400 group-hover:text-emerald-600/70">í˜„ì¬ ì¦‰ì‹œ í™•ì¸í•´ì•¼ í• <br/>í•„ìˆ˜ ì„œë¥˜/ì—…ë¬´ í™•ì¸</p></button>
                                                </div>
                                                <div className="flex-1 px-6 pb-6 overflow-hidden">
                                                    <div className="w-full h-full bg-white rounded-xl border border-slate-200 shadow-inner overflow-y-auto relative custom-scrollbar">
                                                        {aiLoading && (
                                                            <div className="absolute inset-0 flex flex-col items-center justify-center bg-white/95 z-20 backdrop-blur-sm">
                                                                <div className="w-10 h-10 rounded-full border-4 border-slate-100 border-t-blue-600 animate-spin mb-4"></div>
                                                                <p className="text-sm text-slate-600 font-bold animate-pulse">PM Assistantê°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</p>
                                                            </div>
                                                        )}
                                                        <div className="p-6">
                                                            {aiResult ? <div className="prose prose-sm max-w-none text-slate-600 animate-fadeIn" dangerouslySetInnerHTML={{ __html: marked.parse(aiResult) }}></div> : <div className="h-[200px] flex flex-col items-center justify-center text-slate-400/60 text-center"><Icons.Bot /><p className="text-sm font-medium mt-3">ìœ„ ë²„íŠ¼ì„ ëˆŒëŸ¬ AIì—ê²Œ ì—…ë¬´ë¥¼ ì§€ì‹œí•˜ì„¸ìš”</p></div>}
                                                        </div>
                                                    </div>
                                                </div>
                                            </>
                                        )}
                                        {rightPanelTab === 'history' && (
                                            <div className="flex-1 p-6 overflow-hidden">
                                                <div className="w-full h-full bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden flex flex-col">
                                                    <div className="p-4 border-b bg-slate-50 flex items-center justify-between">
                                                        <h3 className="font-bold text-slate-700 text-sm flex items-center gap-2"><Icons.History /> ë³€ê²½ ì´ë ¥</h3>
                                                        <span className="text-xs text-slate-400">ìµœê·¼ 50ê±´</span>
                                                    </div>
                                                    <div className="overflow-y-auto custom-scrollbar flex-1 p-0">
                                                        {historyLogs.length === 0 ? <div className="flex flex-col items-center justify-center h-40 text-slate-400 text-xs"><Icons.History className="mb-2 opacity-50" />ê¸°ë¡ëœ ë³€ê²½ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</div> : (
                                                            <div className="divide-y divide-slate-100">
                                                                {historyLogs.map((log, idx) => (
                                                                    <div key={idx} className="p-4 hover:bg-slate-50 transition">
                                                                        <div className="flex justify-between items-start mb-1"><span className="font-bold text-slate-700 text-xs">{log.action}</span><span className="text-[10px] text-slate-400">{new Date(log.timestamp).toLocaleString()}</span></div>
                                                                        <div className="text-xs text-slate-600 mb-1">{log.detail}</div>
                                                                        <div className="text-[10px] text-blue-500 font-bold bg-blue-50 inline-block px-1.5 py-0.5 rounded">by {log.author}</div>
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                        {rightPanelTab === 'comments' && (
                                            <div className="flex-1 p-6 overflow-hidden flex flex-col">
                                                <div className="flex-1 bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden flex flex-col mb-4 relative">
                                                    <div className="flex-1 overflow-y-auto custom-scrollbar p-4 space-y-4">
                                                        {comments.length === 0 ? <div className="flex flex-col items-center justify-center h-full text-slate-400 text-xs"><Icons.MessageSquare className="mb-2 opacity-50" width={24} height={24} /><p>ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p></div> : 
                                                            comments.map((comment, idx) => {
                                                                const isMe = comment.author === userName;
                                                                return (
                                                                    <div key={idx} className={`flex flex-col ${isMe ? 'items-end' : 'items-start'}`}>
                                                                        <div className="flex items-end gap-2 mb-1 group">
                                                                             {!isMe && <div className="w-6 h-6 rounded-full bg-slate-200 flex items-center justify-center text-[10px] font-bold text-slate-500 shrink-0">{comment.author[0]}</div>}
                                                                             <div className="max-w-[85%]">
                                                                                 {comment.replyTo && <div className={`text-[10px] mb-1 px-2 py-1 rounded border-l-2 ${isMe ? 'bg-indigo-50 border-indigo-200 text-indigo-800' : 'bg-slate-50 border-slate-300 text-slate-500'}`}><span className="font-bold">@{comment.replyTo.author}: </span><span className="truncate block max-w-[150px]">{comment.replyTo.text}</span></div>}
                                                                                 <div className={`px-3 py-2 rounded-2xl text-sm break-words relative ${isMe ? 'bg-indigo-500 text-white rounded-br-none' : 'bg-slate-100 text-slate-700 rounded-bl-none'}`}>{comment.text}</div>
                                                                             </div>
                                                                             <div className="opacity-0 group-hover:opacity-100 transition flex flex-col gap-1">
                                                                                 <button onClick={() => setReplyingTo(comment)} className="text-slate-400 hover:text-indigo-500" title="ë‹µê¸€"><Icons.Reply width={12} height={12} /></button>
                                                                                 {isMe && <button onClick={() => deleteComment(comment.id, mode, db, setComments)} className="text-slate-400 hover:text-red-500" title="ì‚­ì œ"><Icons.Trash2 width={12} height={12} /></button>}
                                                                             </div>
                                                                        </div>
                                                                        <span className="text-[10px] text-slate-400 px-1">{isMe ? '' : `${comment.author} â€¢ `}{formatDateShort(comment.timestamp)}</span>
                                                                    </div>
                                                                );
                                                            })
                                                        }
                                                        <div ref={chatEndRef} />
                                                    </div>
                                                    {replyingTo && <div className="absolute bottom-0 left-0 right-0 bg-indigo-50 border-t border-indigo-100 p-2 flex justify-between items-center text-xs text-indigo-700 animate-slideUp"><div className="truncate pr-2"><span className="font-bold">Replying to @{replyingTo.author}:</span> {replyingTo.text}</div><button onClick={() => setReplyingTo(null)} className="text-indigo-400 hover:text-indigo-900"><Icons.X width={14} height={14}/></button></div>}
                                                </div>
                                                <form onSubmit={(e) => addComment(e, commentInput, editingProject, userName, replyingTo, mode, db, setComments, setCommentInput, setReplyingTo)} className="flex gap-2 shrink-0">
                                                    <input type="text" value={commentInput} onChange={(e) => setCommentInput(e.target.value)} className="flex-1 border border-slate-200 rounded-xl px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500/20" placeholder={replyingTo ? `@${replyingTo.author}ë‹˜ì—ê²Œ ë‹µê¸€...` : "ë©”ì‹œì§€ ì…ë ¥..."} />
                                                    <button type="submit" className="bg-indigo-600 text-white p-3 rounded-xl hover:bg-indigo-700 transition shadow-md disabled:opacity-50" disabled={!commentInput.trim()}><Icons.Send /></button>
                                                </form>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Config Modal */}
                    {configModalOpen && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex justify-center items-center z-[9999] p-4 fade-in">
                            <div className="bg-white rounded-xl shadow-2xl w-full max-w-lg overflow-hidden flex flex-col max-h-[90vh] relative">
                                <button onClick={() => setConfigModalOpen(false)} className="absolute top-4 right-4 p-2 text-slate-400 hover:text-red-500 z-50"><Icons.X /></button>
                                <div className="px-6 py-4 border-b bg-slate-50 flex justify-between items-center shrink-0"><h2 className="font-bold text-lg text-slate-800">ì‹œìŠ¤í…œ ì„¤ì •</h2></div>
                                <div className="p-6 space-y-6 text-sm overflow-y-auto">
                                    <div className="bg-emerald-50 p-4 rounded-lg border border-emerald-100">
                                        <h3 className="font-bold text-emerald-900 mb-2 flex items-center gap-2"><Icons.User /> ì‚¬ìš©ì ì„¤ì •</h3>
                                        <input type="text" className="w-full border border-emerald-200 rounded-lg px-3 py-2 bg-white text-slate-700 outline-none" placeholder="ì˜ˆ: ê¹€PM" value={userName} onChange={(e) => setUserName(e.target.value)} />
                                    </div>
                                    <div className="bg-blue-50 p-4 rounded-lg border border-blue-100">
                                        <h3 className="font-bold text-blue-900 mb-2 flex items-center gap-2"><Icons.Key /> Gemini API Key</h3>
                                        <input type="password" className="w-full border border-blue-200 rounded-lg px-3 py-2 bg-white font-mono text-slate-700 outline-none" placeholder="AIzaSy..." value={geminiApiKey} onChange={(e) => setGeminiApiKey(e.target.value)} />
                                    </div>
                                    <div className="bg-slate-50 p-4 rounded-lg border border-slate-100">
                                        <h3 className="font-bold text-slate-900 mb-2 flex items-center gap-2">ğŸ”¥ Firebase Config (íŒ€ ê³µìœ ìš©)</h3>
                                        <textarea className="w-full h-24 border border-slate-200 rounded-lg p-3 font-mono text-xs bg-white outline-none" placeholder='const firebaseConfig = { ... };' value={firebaseConfigStr} onChange={(e) => setFirebaseConfigStr(e.target.value)}></textarea>
                                    </div>
                                </div>
                                <div className="p-4 border-t bg-slate-50 flex gap-3 shrink-0">
                                    <button onClick={handleConfigClear} className="px-4 py-2.5 text-red-600 font-bold hover:bg-red-50 rounded-lg transition text-xs">ì„¤ì • ì´ˆê¸°í™”</button>
                                    <div className="flex-1"></div>
                                    <button onClick={() => setConfigModalOpen(false)} className="px-5 py-2.5 border border-slate-200 rounded-lg font-bold text-slate-600 hover:bg-slate-100 transition">ì·¨ì†Œ</button>
                                    <button onClick={handleConfigSaveWrapper} className="px-6 py-2.5 bg-slate-900 text-white font-bold rounded-lg hover:bg-slate-800 shadow-lg shadow-slate-900/10 transition">ì„¤ì • ì €ì¥</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>